(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8372],{4184:function(e,s){var a;!function(){"use strict";var t={}.hasOwnProperty;function i(){for(var e=[],s=0;s<arguments.length;s++){var a=arguments[s];if(a){var l=typeof a;if("string"===l||"number"===l)e.push(a);else if(Array.isArray(a)){if(a.length){var r=i.apply(null,a);r&&e.push(r)}}else if("object"===l){if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]")){e.push(a.toString());continue}for(var n in a)t.call(a,n)&&a[n]&&e.push(n)}}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0!==(a=(function(){return i}).apply(s,[]))&&(e.exports=a)}()},8575:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/backend/Cus/[User_ID]",function(){return a(5817)}])},5817:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return u}});var t=a(5893),i=a(7294),l=a(2198),r=a(1163),n=a(6455),c=a.n(n),o=a(1982),d=a(4269),m=a(343);function u(){let e=(0,r.useRouter)(),{User_ID:s}=e.query,[a,n]=(0,i.useState)({firstname:"",lastname:"",tel:"",email:"",password:"",birth_date:"",live:"",subdistrict:"",district:"",province:"",zip_code:""}),[u,p]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),[v,b]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{try{let[e,s,a]=await Promise.all([fetch("https://server.jtppmotor.com/api/provinces"),fetch("https://server.jtppmotor.com/api/districts"),fetch("https://server.jtppmotor.com/api/subdistricts")]),[t,i,l]=await Promise.all([e.json(),s.json(),a.json()]);p(t),f(i),b(l)}catch(e){console.error("Error fetching address data:",e)}})()},[]),(0,i.useEffect)(()=>{let e=async()=>{try{let i=await fetch("https://server.jtppmotor.com/api/get_customers/".concat(s)),l=await i.json();if(i.ok){var e,a,t;let s=new Date(l.birth_date).toISOString().split("T")[0],i=null===(e=u.find(e=>e.name_in_thai===l.province))||void 0===e?void 0:e.id,r=null===(a=h.find(e=>e.name_in_thai===l.district))||void 0===a?void 0:a.id,c=null===(t=v.find(e=>e.name_in_thai===l.subdistrict))||void 0===t?void 0:t.id;n({firstname:l.User_firstName||"",lastname:l.User_lastName||"",tel:l.User_Tel||"",email:l.User_Email||"",password:"",birth_date:s||"",live:l.live||"",subdistrict:c||"",district:r||"",province:i||"",zip_code:l.zip_code||""})}}catch(e){console.error("Error fetching customer data:",e)}};s&&u.length>0&&h.length>0&&v.length>0&&e()},[s,u,h,v]);let j=u.map(e=>({value:e.id,label:e.name_in_thai})),x=a.province?h.filter(e=>e.province_id===Number(a.province)).map(e=>({value:e.id,label:e.name_in_thai})):[],N=a.district?v.filter(e=>e.district_id===Number(a.district)).map(e=>({value:e.id,label:e.name_in_thai,zip_code:e.zip_code})):[],_=e=>{let{name:s,value:a}=e.target;n(e=>({...e,[s]:a}))},w=async t=>{t.preventDefault();let i=(0,o.Z)({firstname:a.firstname,lastname:a.lastname,email:a.email,password:a.password,tel:a.tel});if(Object.keys(i).length>0){let e=Object.values(i).join("\n");await c().fire({title:"ข้อผิดพลาด",text:e,icon:"error"});return}try{let t=u.find(e=>e.id===Number(a.province)),i=h.find(e=>e.id===Number(a.district)),l=v.find(e=>e.id===Number(a.subdistrict)),r={email:a.email,password:a.password,tel:a.tel,firstname:a.firstname,lastname:a.lastname,birth_date:a.birth_date,live:a.live,subdistrict:l?l.name_in_thai:"",district:i?i.name_in_thai:"",province:t?t.name_in_thai:"",zip_code:a.zip_code};(await fetch("https://server.jtppmotor.com/api/edit_customers/".concat(s),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok&&(await c().fire({title:"สำเร็จ",text:"อัปเดตข้อมูลเรียบร้อยแล้ว",icon:"success"}),e.push("/backend/Cus/Customer"))}catch(e){console.error("Error:",e),await c().fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error"})}};return(0,t.jsxs)("div",{className:"d-flex",children:[(0,t.jsx)(l.default,{}),(0,t.jsx)("div",{className:"flex-grow-1",children:(0,t.jsx)("div",{className:"container py-5",children:(0,t.jsx)("div",{className:"row justify-content-center",children:(0,t.jsx)("div",{className:"col-md-8",children:(0,t.jsx)("div",{className:"card shadow",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("div",{className:"text-end mb-3",children:(0,t.jsxs)("button",{className:"btn btn-secondary",onClick:()=>e.push("/backend/Cus/Customer"),children:[(0,t.jsx)("i",{className:"bi bi-arrow-left"})," ย้อนกลับ"]})}),(0,t.jsx)("h2",{className:"card-title text-center mb-4",style:{fontSize:"1.7rem",fontWeight:"bold"},children:"แก้ไขข้อมูลลูกค้า"}),(0,t.jsxs)("form",{onSubmit:w,children:[(0,t.jsxs)("div",{className:"row mb-3",children:[(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"ชื่อ"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"firstname",value:a.firstname,onChange:_,required:!0})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"นามสกุล"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"lastname",value:a.lastname,onChange:_,required:!0})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"เบอร์โทรศัพท์"}),(0,t.jsx)("input",{type:"tel",className:"form-control",name:"tel",value:a.tel,onChange:_})]})]}),(0,t.jsxs)("div",{className:"row mb-3",children:[(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{className:"form-label",children:"อีเมล"}),(0,t.jsx)("input",{type:"email",className:"form-control",name:"email",value:a.email,onChange:_,required:!0})]}),(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{className:"form-label",children:"รหัสผ่าน"}),(0,t.jsx)("input",{type:"password",className:"form-control",name:"password",value:a.password,onChange:_,placeholder:"ใส่รหัสผ่านเพื่อเปลี่ยนแปลงข้อมูล"})]})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"วันเกิด"}),(0,t.jsx)("input",{type:"date",className:"form-control",name:"birth_date",value:a.birth_date,onChange:_})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"ที่อยู่"}),(0,t.jsx)("textarea",{className:"form-control",name:"live",value:a.live,onChange:_,rows:"3"})]}),(0,t.jsxs)("div",{className:"row mb-3",children:[(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"จังหวัด"}),(0,t.jsx)(d.ZP,{components:(0,m.ZP)(),options:j,value:j.find(e=>Number(e.value)===Number(a.province))||null,onChange:e=>{n(s=>({...s,province:e?e.value:"",district:"",subdistrict:"",zip_code:""}))},placeholder:"เลือกจังหวัด"})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"อำเภอ"}),(0,t.jsx)(d.ZP,{components:(0,m.ZP)(),options:x,value:x.find(e=>Number(e.value)===Number(a.district))||null,onChange:e=>{n(s=>({...s,district:e?e.value:"",subdistrict:"",zip_code:""}))},placeholder:"เลือกอำเภอ",isDisabled:!a.province})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"ตำบล"}),(0,t.jsx)(d.ZP,{components:(0,m.ZP)(),options:N,value:N.find(e=>Number(e.value)===Number(a.subdistrict))||null,onChange:e=>{n(s=>({...s,subdistrict:e?e.value:"",zip_code:e&&e.zip_code||""}))},placeholder:"เลือกตำบล",isDisabled:!a.district})]})]}),(0,t.jsx)("div",{className:"row mb-3",children:(0,t.jsxs)("div",{className:"col-md-3",children:[(0,t.jsx)("label",{className:"form-label",children:"รหัสไปรษณีย์"}),(0,t.jsx)("input",{type:"text",className:"form-control",name:"zip_code",value:a.zip_code,readOnly:!0})]})}),(0,t.jsx)("div",{className:"d-grid gap-2",children:(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",children:"บันทึกการเปลี่ยนแปลง"})})]})]})})})})})})]})}},1982:function(e,s,a){"use strict";function t(e){let s={},a=/^[a-zA-Zก-ฮะ-์]+$/;return""===e.firstname?s.firstname="ชื่อไม่ควรที่จะเป็นช่องว่าง":a.test(e.firstname)||(s.firstname="ชื่อไม่ควรมีตัวเลขหรืออักษรพิเศษ"),""===e.lastname?s.lastname="นามสกุลไม่ควรที่จะเป็นช่องว่าง":a.test(e.lastname)||(s.lastname="นามสกุลไม่ควรมีตัวเลขหรืออักษรพิเศษ"),""===e.email?s.email="อีเมลไม่ควรที่จะเป็นช่องว่าง":/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.email)||(s.email="อีเมลไม่ถูกต้อง"),""===e.password?s.password="รหัสไม่ควรที่จะเป็นช่องว่าง":/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,20}/.test(e.password)||(s.password="รหัสผ่านไม่ถูกต้อง"),""===e.tel?s.tel="เบอร์โทรศัพท์ไม่ควรที่จะเป็นช่องว่าง":/^\d{10}$/.test(e.tel)||(s.tel="เบอร์โทรศัพท์ไม่ถูกต้อง"),s}a.d(s,{Z:function(){return t}})}},function(e){e.O(0,[676,343,4269,2198,2888,9774,179],function(){return e(e.s=8575)}),_N_E=e.O()}]);