(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7145],{801:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/backend/IE/Income_Expenses",function(){return a(9918)}])},9918:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var r=a(5893),s=a(645),n=a.n(s),l=a(7294),c=a(3148);c.kL.register(...c.zX);var i=c.kL,o=a(6455),d=a.n(o),b=a(7630),m=a.n(b),x=a(1163),h=a(2198),u=a(4678),g=a(9578),p=a(1937);a(3502);let y=e=>{let{title:t,value:a,icon:s,colorClass:n}=e;return(0,r.jsx)("div",{className:"card modern-card stat-card h-100 ".concat("--green-gradient"===n?"income-card":"expense-card"),children:(0,r.jsxs)("div",{className:"card-body position-relative p-4",children:[(0,r.jsx)("div",{className:"card-overlay"}),(0,r.jsx)("div",{className:"icon-background",children:(0,r.jsx)("i",{className:"bi ".concat(s)})}),(0,r.jsxs)("div",{className:"content-wrapper position-relative",children:[(0,r.jsx)("h6",{className:"stat-title text-uppercase fw-bold mb-3",children:t}),(0,r.jsxs)("h3",{className:"stat-value mb-0",children:[a," บาท"]})]})]})})},j=e=>{switch(e){case"daily":return[(0,u.WU)(new Date,"dd/MM/yyyy")];case"weekly":return Array.from({length:7},(e,t)=>{let a=(0,g.k)(new Date,6-t);return(0,u.WU)(a,"dd/MM")});case"monthly":return Array.from({length:31},(e,t)=>"".concat(t+1));case"yearly":return["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."];default:return[]}};function f(){let[e,t]=(0,l.useState)([]),[a,s]=(0,l.useState)([]),[c,o]=(0,l.useState)(0),[b,g]=(0,l.useState)(0),[f,N]=(0,l.useState)("daily"),w=m()(d()),v=(0,l.useRef)(null),[k,_]=(0,l.useState)(null),M=(0,x.useRouter)(),S=()=>{let e=new Date;switch(f){case"daily":default:return[(0,u.WU)(e,"yyyy-MM-dd 00:00:00"),(0,u.WU)(e,"yyyy-MM-dd 23:59:59")];case"weekly":return[(0,u.WU)((0,p.t)(e,1),"yyyy-MM-dd 00:00:00"),(0,u.WU)(e,"yyyy-MM-dd 23:59:59")];case"monthly":return[(0,u.WU)(new Date(e.getFullYear(),e.getMonth(),1),"yyyy-MM-dd 00:00:00"),(0,u.WU)(e,"yyyy-MM-dd 23:59:59")];case"yearly":return[(0,u.WU)(new Date(e.getFullYear(),0,1),"yyyy-MM-dd 00:00:00"),(0,u.WU)(e,"yyyy-MM-dd 23:59:59")]}},C=async()=>{let[e,a]=S();try{let r=await fetch("https://server.jtppmotor.com/api/income?start=".concat(e,"&end=").concat(a)),s=await r.json();t(s);let n=s.reduce((e,t)=>e+t.TotalPrice,0);o(n)}catch(e){console.error("Error fetching income data:",e)}},E=async()=>{let[e,t]=S();try{let a=await fetch("https://server.jtppmotor.com/api/expenses?start=".concat(e,"&end=").concat(t)),r=await a.json();s(r);let n=r.reduce((e,t)=>e+t.total,0);g(n)}catch(e){console.error("Error fetching expense data:",e)}};(0,l.useEffect)(()=>{C(),E()},[f]),(0,l.useEffect)(()=>{k&&k.destroy();let t=v.current.getContext("2d"),r=j(f),s=new i(t,{type:"bar",data:{labels:r,datasets:[{label:"รายรับ",data:"daily"===f?[c]:r.map((t,a)=>e.filter(e=>{let t=new Date(e.Date);return"weekly"===f?(0,u.WU)(t,"dd/MM")===r[a]:"monthly"===f?t.getDate()===a+1:"yearly"===f&&t.getMonth()===a}).reduce((e,t)=>e+Number(t.TotalPrice),0)),backgroundColor:"rgba(26, 95, 122, 0.7)",borderColor:"#1a5f7a",borderWidth:2,borderRadius:5,barThickness:"daily"===f?180:void 0},{label:"รายจ่าย",data:"daily"===f?[b]:r.map((e,t)=>a.filter(e=>{let a=new Date(e.date);return"weekly"===f?(0,u.WU)(a,"dd/MM")===r[t]:"monthly"===f?a.getDate()===t+1:"yearly"===f&&a.getMonth()===t}).reduce((e,t)=>e+Number(t.total),0)),backgroundColor:"rgba(231, 76, 60, 0.7)",borderColor:"#c0392b",borderWidth:2,borderRadius:5,barThickness:"daily"===f?180:void 0}]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:1500,easing:"easeInOutQuart"},plugins:{legend:{position:"top",labels:{padding:20,font:{family:"'Segoe UI', sans-serif",size:14,weight:"bold"},usePointStyle:!0,pointStyle:"circle"}},title:{display:!0,text:"สรุปรายรับ-รายจ่ายประจำวัน",font:{family:"'Segoe UI', sans-serif",size:20,weight:"bold"},padding:20,color:"#2c3e50"},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#2c3e50",titleFont:{size:14,weight:"bold"},bodyColor:"#34495e",bodyFont:{size:13},borderColor:"#eee",borderWidth:1,padding:12,displayColors:!0,callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB"}).format(e.parsed.y)),t}}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)",drawBorder:!1},ticks:{font:{family:"'Segoe UI', sans-serif",size:12},color:"#34495e",padding:10,callback:e=>new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB"}).format(e)}},x:{grid:{display:!1},ticks:{font:{family:"'Segoe UI', sans-serif",size:12,weight:"bold"},color:"#34495e",padding:10}}}}});return _(s),()=>{s&&s.destroy()}},[f,c,b,e,a]);let T=async()=>{let e=[];try{let t=await fetch("https://server.jtppmotor.com/api/hisOrder");e=await t.json()}catch(e){console.error("Error fetching categories:",e)}let{value:t}=await w.fire({title:"เพิ่มข้อมูลรายจ่าย",html:(0,r.jsxs)("div",{children:[(0,r.jsxs)("select",{id:"category",className:"swal2-input",children:[(0,r.jsx)("option",{value:"",children:"เลือกหมวดหมู่"}),e.map(e=>(0,r.jsx)("option",{value:e.h_Name,children:"Sell"===e.h_Name?"ขายสินค้า":"Repair"===e.h_Name?"การซ่อม":"Other"===e.h_Name?"อื่นๆ":e.h_Name},e.history_order_ID))]}),(0,r.jsx)("input",{id:"title",type:"text",className:"swal2-input",placeholder:"ชื่อรายการ"}),(0,r.jsx)("input",{id:"price",type:"number",className:"swal2-input",placeholder:"ราคา"}),(0,r.jsx)("input",{id:"amount",type:"number",className:"swal2-input",placeholder:"จำนวน"})]}),showCancelButton:!0,confirmButtonText:"บันทึก",cancelButtonText:"ยกเลิก",focusConfirm:!1,preConfirm:()=>{let e=document.getElementById("category").value,t=document.getElementById("title").value,a=document.getElementById("price").value,r=document.getElementById("amount").value;return e&&t&&a&&r||d().showValidationMessage("กรุณากรอกข้อมูลให้ครบถ้วน"),{category:e,title:t,price:a,amount:r}}});if(t){let{category:e,title:a,price:r,amount:s}=t,n=parseInt(r)*parseInt(s);try{(await fetch("https://server.jtppmotor.com/api/addExpense",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:e,title:a,price:parseInt(r),amount:parseInt(s),totalPrice:n})})).ok?(d().fire("บันทึกข้อมูลสำเร็จ!","","success"),E()):d().fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}catch(e){console.error("Error saving expense:",e),d().fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}}},z=e=>{let t=new Date(e),a=t.getDate().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear(),n=t.getHours().toString().padStart(2,"0"),l=t.getMinutes().toString().padStart(2,"0");return"".concat(a,"/").concat(r,"/").concat(s," ").concat(n,":").concat(l)};return(0,r.jsxs)("div",{className:"d-flex vh-100 bg-light-modern",children:[(0,r.jsx)(h.default,{}),(0,r.jsx)("div",{className:"flex-grow-1 overflow-auto",children:(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 container-fluid py-4",children:[(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 d-flex justify-content-between align-items-center mb-4",children:[(0,r.jsx)("h2",{className:"jsx-91302b55ce261be8 fw-bold",children:"รายรับ - รายจ่าย"}),(0,r.jsxs)("button",{onClick:()=>M.back(),className:"jsx-91302b55ce261be8 btn btn-outline-secondary btn-modern d-flex align-items-center gap-2",children:[(0,r.jsx)("i",{className:"jsx-91302b55ce261be8 bi bi-arrow-left"}),"กลับ"]})]}),(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 row g-4 mb-4",children:[(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 col-xl-6 col-md-6",children:(0,r.jsx)(y,{title:"รายรับทั้งหมด",value:new Intl.NumberFormat("th-TH").format(c),icon:"bi-graph-up",colorClass:"--green-gradient"})}),(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 col-xl-6 col-md-6",children:(0,r.jsx)(y,{title:"รายจ่ายทั้งหมด",value:new Intl.NumberFormat("th-TH").format(b),icon:"bi-graph-down",colorClass:"--red-gradient"})})]}),(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 chart-wrapper card modern-card shadow-lg mb-4",children:[(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 card-header bg-white d-flex justify-content-between align-items-center py-3",children:[(0,r.jsx)("h5",{className:"jsx-91302b55ce261be8 mb-0 fw-semibold",children:"กราฟรายรับ-รายจ่าย"}),(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 btn-group",children:[{id:"daily",label:"รายวัน"},{id:"weekly",label:"รายสัปดาห์"},{id:"monthly",label:"รายเดือน"},{id:"yearly",label:"รายปี"}].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>N(e.id),className:"jsx-91302b55ce261be8 "+"btn btn-modern ".concat(f===e.id?"btn-primary":"btn-outline-primary"),children:e.label},e.id))})]}),(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 card-body p-4",children:(0,r.jsx)("div",{style:{height:"400px"},className:"jsx-91302b55ce261be8",children:(0,r.jsx)("canvas",{ref:v,className:"jsx-91302b55ce261be8"})})})]}),(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 card mb-4 shadow-sm table-card",children:[(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 card-header bg-primary text-white d-flex justify-content-between align-items-center",children:(0,r.jsx)("h5",{className:"jsx-91302b55ce261be8 mb-0",children:"รายรับ"})}),(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 card-body",children:(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 table-responsive",children:(0,r.jsxs)("table",{className:"jsx-91302b55ce261be8 table table-hover table-bordered",children:[(0,r.jsx)("thead",{className:"jsx-91302b55ce261be8 thead-light",children:(0,r.jsxs)("tr",{className:"jsx-91302b55ce261be8",children:[(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"หมวดหมู่"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"ชื่อลูกค้า"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"ชื่อสินค้า/บริการ"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"วันที่"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"จำนวน"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"ราคา"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"ยอดรวม"})]})}),(0,r.jsx)("tbody",{className:"jsx-91302b55ce261be8",children:e.map((e,t)=>(0,r.jsxs)("tr",{className:"jsx-91302b55ce261be8",children:[(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:"sell"===e.category?"ขายสินค้า":"repair"===e.category?"การซ่อม":e.category}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.UserName}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:"repair"===e.category?"".concat(e.Brand_Name," - ").concat(e.Model_Name):e.Product_Name}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:z(e.Date)}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.Amount}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.Price.toLocaleString()}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.TotalPrice.toLocaleString()})]},t))})]})})})]}),(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 card mb-4 shadow-sm table-card",children:[(0,r.jsxs)("div",{className:"jsx-91302b55ce261be8 card-header bg-warning text-dark d-flex justify-content-between align-items-center",children:[(0,r.jsx)("h5",{className:"jsx-91302b55ce261be8 mb-0",children:"รายจ่าย"}),(0,r.jsxs)("button",{type:"button",onClick:T,className:"jsx-91302b55ce261be8 btn btn-dark",children:[(0,r.jsx)("i",{className:"jsx-91302b55ce261be8 bi bi-plus-circle me-2"}),"เพิ่มรายจ่าย"]})]}),(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 card-body",children:(0,r.jsx)("div",{className:"jsx-91302b55ce261be8 table-responsive",children:(0,r.jsxs)("table",{className:"jsx-91302b55ce261be8 table table-hover table-bordered",children:[(0,r.jsx)("thead",{className:"jsx-91302b55ce261be8 thead-light",children:(0,r.jsxs)("tr",{className:"jsx-91302b55ce261be8",children:[(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"หมวดหมู่"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"ชื่อรายการ"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"วันที่"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"จำนวน"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"ราคา"}),(0,r.jsx)("th",{className:"jsx-91302b55ce261be8",children:"ยอดรวม"})]})}),(0,r.jsx)("tbody",{className:"jsx-91302b55ce261be8",children:a.map((e,t)=>(0,r.jsxs)("tr",{className:"jsx-91302b55ce261be8",children:[(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:"Update Stock"===e.change_type?"เพิ่มสต็อกสินค้าเข้ามาใหม่":"Other"===e.change_type?"อื่นๆ":"Repair"===e.change_type?"การซ่อม":"Sell"===e.change_type?"ขายสินค้า":e.change_type}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.name}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:z(e.date)}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.new_stock?e.new_stock.toLocaleString():0}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.cost?e.cost.toLocaleString():e.price}),(0,r.jsx)("td",{className:"jsx-91302b55ce261be8",children:e.total?e.total.toLocaleString():0})]},t))})]})})})]}),(0,r.jsx)(n(),{id:"91302b55ce261be8",children:":root{--bg-gradient:linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);--green-gradient:linear-gradient(\r\n                135deg,\r\n                #1a5f7a 0%,\r\n                #2c3e50 100%\r\n              );--red-gradient:linear-gradient(135deg, #934141 0%, #6d3434 100%)}.bg-light-modern{background:var(--bg-gradient)}.modern-card{-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;border:none;overflow:hidden;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.stat-card{border:none;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;overflow:hidden;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.income-card{background:var(--green-gradient)}.expense-card{background:var(--red-gradient)}.stat-card:hover{-webkit-transform:translatey(-5px);-moz-transform:translatey(-5px);-ms-transform:translatey(-5px);-o-transform:translatey(-5px);transform:translatey(-5px);-webkit-box-shadow:0 8px 25px rgba(0,0,0,.2);-moz-box-shadow:0 8px 25px rgba(0,0,0,.2);box-shadow:0 8px 25px rgba(0,0,0,.2)}.card-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:-webkit-linear-gradient(45deg,rgba(255,255,255,.1)0%,rgba(255,255,255,.05)100%);background:-moz-linear-gradient(45deg,rgba(255,255,255,.1)0%,rgba(255,255,255,.05)100%);background:-o-linear-gradient(45deg,rgba(255,255,255,.1)0%,rgba(255,255,255,.05)100%);background:linear-gradient(45deg,rgba(255,255,255,.1)0%,rgba(255,255,255,.05)100%);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px}.icon-background{position:absolute;top:50%;right:1.5rem;-webkit-transform:translatey(-50%);-moz-transform:translatey(-50%);-ms-transform:translatey(-50%);-o-transform:translatey(-50%);transform:translatey(-50%);font-size:3rem;opacity:.15;color:rgba(255,255,255,.15)}.stat-title{color:rgba(255,255,255,.95);font-size:1rem;letter-spacing:1.2px;text-shadow:1px 1px 3px rgba(0,0,0,.2)}.stat-value{color:#fff;font-size:2rem;font-weight:700;letter-spacing:.8px;text-shadow:2px 2px 4px rgba(0,0,0,.2)}.btn-modern{padding:.5rem 1rem;font-weight:500;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.btn-modern:hover{-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px)}"})]})})]})}},3502:function(){},7630:function(e,t,a){var r;r=function(e,t){"use strict";let a=[{key:"title",getter:e=>e.getTitle()},{key:"html",getter:e=>e.getHtmlContainer()},{key:"confirmButtonText",getter:e=>e.getConfirmButton()},{key:"denyButtonText",getter:e=>e.getDenyButton()},{key:"cancelButtonText",getter:e=>e.getCancelButton()},{key:"footer",getter:e=>e.getFooter()},{key:"closeButtonHtml",getter:e=>e.getCloseButton()},{key:"iconHtml",getter:e=>e.getIconContent()},{key:"loaderHtml",getter:e=>e.getLoader()}],r=()=>{};return function(s){function n(t){let r={},s={},n=a.map(e=>e.key);return Object.entries(t).forEach(t=>{let[a,l]=t;n.includes(a)&&e.isValidElement(l)?(r[a]=l,s[a]=" "):s[a]=l}),[r,s]}function l(e,r){Object.entries(r).forEach(r=>{let[n,l]=r,c=a.find(e=>e.key===n).getter(s),i=t.createRoot(c);i.render(l),e.__roots.push(i)})}function c(e){e.__roots.forEach(e=>{e.unmount()}),e.__roots=[]}return class extends s{static argsToParams(t){if(!(e.isValidElement(t[0])||e.isValidElement(t[1])))return s.argsToParams(t);{let e={};return["title","html","icon"].forEach((a,r)=>{void 0!==t[r]&&(e[a]=t[r])}),e}}_main(e,t){this.__roots=[],this.__params=Object.assign({},t,e);let[a,s]=n(this.__params),i=s.willOpen||r,o=s.didOpen||r,d=s.didDestroy||r;return super._main(Object.assign({},s,{willOpen:e=>{l(this,a),i(e)},didOpen:e=>{setTimeout(()=>{o(e)})},didDestroy:e=>{d(e),c(this)}}))}update(e){Object.assign(this.__params,e),c(this);let[t,a]=n(this.__params);super.update(a),l(this,t)}}}},e.exports=r(a(7294),a(745))}},function(e){e.O(0,[2196,645,3809,7209,2198,2888,9774,179],function(){return e(e.s=801)}),_N_E=e.O()}]);