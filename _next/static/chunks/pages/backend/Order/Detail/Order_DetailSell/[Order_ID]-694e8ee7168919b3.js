(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4795],{4184:function(e,n){var r;!function(){"use strict";var t={}.hasOwnProperty;function s(){for(var e=[],n=0;n<arguments.length;n++){var r=arguments[n];if(r){var i=typeof r;if("string"===i||"number"===i)e.push(r);else if(Array.isArray(r)){if(r.length){var o=s.apply(null,r);o&&e.push(o)}}else if("object"===i){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){e.push(r.toString());continue}for(var c in r)t.call(r,c)&&r[c]&&e.push(c)}}}return e.join(" ")}e.exports?(s.default=s,e.exports=s):void 0!==(r=(function(){return s}).apply(n,[]))&&(e.exports=r)}()},1471:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/backend/Order/Detail/Order_DetailSell/[Order_ID]",function(){return r(8240)}])},8240:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return d}});var t=r(5893),s=r(7294),i=r(1163),o=r(2198),c=r(6455),a=r.n(c);function d(){let[e,n]=(0,s.useState)(null),[r,c]=(0,s.useState)(!1),[d,l]=(0,s.useState)([]),h=(0,i.useRouter)(),{Order_ID:m}=h.query;(0,s.useEffect)(()=>{m&&x()},[m]);let x=async()=>{try{let e=await fetch("https://server.jtppmotor.com/api/get_orderSell/".concat(m));if(e.ok){let r=await e.json();n(r),l(r.Order_Details),console.log(r)}else a().fire("ข้อผิดพลาด","ไม่สามารถโหลดข้อมูลออเดอร์ได้","error")}catch(e){console.error("Error fetching order data:",e),a().fire("ข้อผิดพลาด","เกิดข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์","error")}},p=async e=>{try{let n=await fetch("https://server.jtppmotor.com/api/generateQR",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Order_TotalPrice:e})}),r=await n.json();if(n.ok){let n=(window.screen.width-400)/2,t=(window.screen.height-600)/2;window.open("","QRCodePopup","width=".concat(400,",\n                         height=").concat(600,",\n                         left=").concat(n,",\n                         top=").concat(t,",\n                         resizable=no")).document.write('\n                        <html>\n                            <head>\n                                <title>QR Code ชำระเงิน</title>\n                                <style>\n                                * {\n                                    margin: 0;\n                                    padding: 0;\n                                    box-sizing: border-box;\n                                }\n                                body {\n                                    min-height: 100vh;\n                                    display: flex;\n                                    align-items: center;\n                                    justify-content: center;\n                                    background-color: #f8f9fa;\n                                    font-family: Arial, sans-serif;\n                                }\n                                .container {\n                                    width: 90%;\n                                    max-width: 350px;\n                                    text-align: center;\n                                    background: white;\n                                    padding: 30px;\n                                    border-radius: 10px;\n                                    box-shadow: 0 0 10px rgba(0,0,0,0.1);\n                                }\n                                h2 {\n                                    color: #333;\n                                    margin-bottom: 15px;\n                                }\n                                .price {\n                                    font-size: 24px;\n                                    color: #28a745;\n                                    margin-bottom: 20px;\n                                    font-weight: bold;\n                                }\n                                img {\n                                    width: 100%;\n                                    max-width: 250px;\n                                    height: auto;\n                                    margin: 20px auto;\n                                    display: block;\n                                }\n                                button {\n                                    width: 100%;\n                                    padding: 12px;\n                                    background-color: #28a745;\n                                    color: white;\n                                    border: none;\n                                    border-radius: 5px;\n                                    cursor: pointer;\n                                    font-size: 16px;\n                                    font-weight: bold;\n                                    transition: background-color 0.3s;\n                                }\n                                button:hover {\n                                    background-color: #218838;\n                                }\n                            </style>\n                            </head>\n                            <body>\n                                <div class="container">\n                                    <h2>QR Code ชำระเงิน</h2>\n                                    <div class="price">฿'.concat(e.toFixed(2),'</div>\n                                    <img src="').concat(r.url,'" alt="QR Code Promptpay">\n                                    <button onclick="confirmPayment()">ยืนยันการชำระเงิน</button>\n                                </div>\n                                <script>\n                                    function confirmPayment() {\n                                        window.opener.confirmQRPayment();\n                                        window.close();\n                                    }\n                                </script>\n                            </body>\n                        </html>\n                    '))}else a().fire("เกิดข้อผิดพลาด",r.RespMessage,"error")}catch(e){console.error("Error generating QR Code:",e),a().fire("เกิดข้อผิดพลาด","ไม่สามารถสร้าง QR Code ได้","error")}};window.confirmQRPayment=async()=>{try{await u(),a().fire("การชำระเงินสำเร็จ!","","success").then(()=>{h.push("/backend/Order/Order")})}catch(e){console.error("Error confirming QR payment:",e)}};let u=async()=>{try{let n=await fetch("https://server.jtppmotor.com/api/history_orderSell",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:e})}),r=await n.json();if(!n.ok)throw Error(r.message)}catch(e){console.error("Error saving history order:",e),a().fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลประวัติออเดอร์ได้","error")}},f=async()=>{let n=d.map(e=>{let n=document.getElementById("amount-".concat(e.Product_ID)),r=n?parseInt(n.value):e.Order_detail_amount;return{...e,Order_detail_amount:r,Order_detail_priceAll:r*e.Order_detail_price}}),r={userId:e.User_ID||null,userName:e.User_Name||"",userTel:e.User_Tel||"",orderNote:e.Order_Note||"",orderDetails:n};try{let e=await fetch("https://server.jtppmotor.com/api/update_orderSell/".concat(m),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(e.ok)a().fire("บันทึกจำนวนสินค้าเรียบร้อย!","","success").then(()=>{h.reload()}),c(!1);else{let n=await e.json();a().fire("เกิดข้อผิดพลาดในการบันทึก",n.error,"error")}}catch(e){console.error("Error updating order:",e),a().fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}};if(!e)return(0,t.jsx)("div",{children:"Loading..."});let j=e.Order_Details||[];return(0,t.jsxs)("div",{className:"d-flex",children:[(0,t.jsx)(o.default,{}),(0,t.jsx)("div",{className:"flex-grow-1 bg-light",children:(0,t.jsxs)("div",{className:"container",children:[(0,t.jsx)("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom",style:{width:"100%",height:"50px"},children:(0,t.jsx)("div",{className:"d-flex justify-content-end w-98",children:(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{h.push("/backend/Order/Order")},children:"ย้อนกลับ"})})}),(0,t.jsx)("div",{className:"d-flex flex-wrap align-items-center justify-content-center justify-content-md-between",children:(0,t.jsxs)("a",{className:"d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none",children:[(0,t.jsx)("i",{className:"bi bi-clipboard2 me-2"}),"รายละเอียดออเดอร์ #",e.Order_ID]})}),(0,t.jsx)("div",{className:"my-4"}),(0,t.jsxs)("div",{className:"card shadow-sm mb-4",children:[(0,t.jsx)("div",{className:"card-header bg-primary text-white",children:(0,t.jsx)("h5",{className:"mb-0",children:"ข้อมูลลูกค้า"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ชื่อ:"})," ",e.User_Name]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"เบอร์โทร:"})," ",e.User_Tel]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"อีเมล:"})," ",e.User_Email||"ไม่พบข้อมูล"]})})]})})]}),(0,t.jsxs)("div",{className:"card shadow-sm mb-4",children:[(0,t.jsx)("div",{className:"card-header bg-success text-white",children:(0,t.jsx)("h5",{className:"mb-0",children:"รายการสินค้า"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-striped",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"รหัสสินค้า"}),(0,t.jsx)("th",{children:"ยี่ห้อ"}),(0,t.jsx)("th",{children:"รุ่น"}),(0,t.jsx)("th",{children:"ชื่อสินค้า"}),(0,t.jsx)("th",{children:"ราคา"}),(0,t.jsx)("th",{children:"จำนวน"}),(0,t.jsx)("th",{children:"ราคารวม"})]})}),(0,t.jsx)("tbody",{children:j.map((e,n)=>{let{Product_ID:s,Product_Name:i,Order_detail_price:o,Order_detail_amount:c,Order_detail_priceAll:a,Product_Brand:d,Product_Model:l}=e;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:s}),(0,t.jsx)("td",{children:d}),(0,t.jsx)("td",{children:l}),(0,t.jsx)("td",{children:i}),(0,t.jsx)("td",{children:o}),(0,t.jsx)("td",{children:r?(0,t.jsx)("input",{type:"number",id:"amount-".concat(s),defaultValue:c,className:"form-control"}):(0,t.jsx)("span",{children:c})}),(0,t.jsx)("td",{children:a})]},n)})})]})})})]}),(0,t.jsxs)("div",{className:"card shadow-sm mb-4",children:[(0,t.jsx)("div",{className:"card-header bg-info text-white",children:(0,t.jsx)("h5",{className:"mb-0",children:"รายละเอียดการสั่งซื้อ"})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"สถานะ:"})," ",e.Order_Status]})}),(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ราคารวม:"})," ",e.Order_TotalPrice," บาท"]})})]}),(0,t.jsx)("div",{className:"row",children:(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"หมายเหตุ:"})," ",e.Order_Note||"-"]})})})]})]}),(0,t.jsxs)("div",{className:"d-flex gap-2 justify-content-end w-98",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-warning",onClick:()=>{c(!r)},children:r?"ยกเลิก":"แก้ไขจำนวนสินค้า"}),r&&(0,t.jsx)("button",{type:"button",className:"btn btn-primary",onClick:f,children:"บันทึกจำนวนสินค้า"}),(0,t.jsx)("button",{type:"button",className:"btn btn-success",onClick:()=>{a().fire({title:"ช่องทางการชำระเงิน?",icon:"question",showCancelButton:!0,confirmButtonText:"ชำระเงินสด",cancelButtonText:"ชำระผ่าน QRcode Promptpay"}).then(n=>{n.isConfirmed?a().fire({title:"กรุณายืนยัน",text:"ยืนยันว่าชำระเงินเสร็จสิ้นแล้วหรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก"}).then(async e=>{e.isConfirmed&&(await u(),a().fire("การชำระเงินสำเร็จ!","","success"),h.push("/backend/Order/Order"))}):n.dismiss===a().DismissReason.cancel&&p(e.Order_TotalPrice)})},children:"ยืนยันการขาย"})]})]})})]})}}},function(e){e.O(0,[2198,2888,9774,179],function(){return e(e.s=1471)}),_N_E=e.O()}]);