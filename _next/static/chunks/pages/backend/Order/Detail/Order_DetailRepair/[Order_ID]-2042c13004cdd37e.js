(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7712],{4184:function(e,n){var r;!function(){"use strict";var t={}.hasOwnProperty;function s(){for(var e=[],n=0;n<arguments.length;n++){var r=arguments[n];if(r){var i=typeof r;if("string"===i||"number"===i)e.push(r);else if(Array.isArray(r)){if(r.length){var o=s.apply(null,r);o&&e.push(o)}}else if("object"===i){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){e.push(r.toString());continue}for(var a in r)t.call(r,a)&&r[a]&&e.push(a)}}}return e.join(" ")}e.exports?(s.default=s,e.exports=s):void 0!==(r=(function(){return s}).apply(n,[]))&&(e.exports=r)}()},8670:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/backend/Order/Detail/Order_DetailRepair/[Order_ID]",function(){return r(8474)}])},8474:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return d}});var t=r(5893),s=r(7294),i=r(1163),o=r(2198),a=r(6455),c=r.n(a);function d(){var e,n,r,a,d,l,h,p,u,m;let[x,f]=(0,s.useState)(null),[j,b]=(0,s.useState)(!1),[g,v]=(0,s.useState)([]),_=(0,i.useRouter)(),{Order_ID:y}=_.query;(0,s.useEffect)(()=>{y&&N()},[y]);let N=async()=>{try{let e=await fetch("https://server.jtppmotor.com/api/get_orderRepair/".concat(y));if(e.ok){let n=await e.json();f(n),v(n.Repair_Details),console.log(n)}else c().fire("ข้อผิดพลาด","ไม่สามารถโหลดข้อมูลออเดอร์ได้","error")}catch(e){console.error("Error fetching order data:",e),c().fire("ข้อผิดพลาด","เกิดข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์","error")}},w=async()=>{try{let e=await fetch("https://server.jtppmotor.com/api/history_orderRepair",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:x})}),n=await e.json();if(!e.ok)throw Error(n.message)}catch(e){console.error("Error saving history order:",e),c().fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลประวัติออเดอร์ได้","error")}},P=async e=>{try{let n=await fetch("https://server.jtppmotor.com/api/generateQR",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Order_TotalPrice:e})}),r=await n.json();if(n.ok){let n=(window.screen.width-400)/2,t=(window.screen.height-600)/2;window.open("","QRCodePopup","width=".concat(400,",\n                         height=").concat(600,",\n                         left=").concat(n,",\n                         top=").concat(t,",\n                         resizable=no,\n                         scrollbars=no,\n                         status=no")).document.write('\n                        <html>\n                            <head>\n                                <title>QR Code สำหรับชำระเงิน</title>\n                                <style>\n                                    body {\n                                        margin: 0;\n                                        padding: 0;\n                                        min-height: 100vh;\n                                        display: flex;\n                                        align-items: center;\n                                        justify-content: center;\n                                        background-color: #f8f9fa;\n                                        font-family: Arial, sans-serif;\n                                    }\n                                    .container {\n                                        width: 100%;\n                                        max-width: 400px;\n                                        padding: 20px;\n                                        box-sizing: border-box;\n                                        text-align: center;\n                                    }\n                                    img {\n                                        width: 100%;\n                                        max-width: 300px;\n                                        height: auto;\n                                        margin: 20px 0;\n                                        display: block;\n                                        margin-left: auto;\n                                        margin-right: auto;\n                                    }\n                                    h2 {\n                                        color: #333;\n                                        margin-bottom: 20px;\n                                    }\n                                    .price {\n                                        font-size: 24px;\n                                        color: #28a745;\n                                        margin-bottom: 20px;\n                                    }\n                                    button {\n                                        padding: 10px 20px;\n                                        background-color: #28a745;\n                                        color: white;\n                                        border: none;\n                                        border-radius: 5px;\n                                        cursor: pointer;\n                                        font-size: 16px;\n                                        margin-top: 20px;\n                                    }\n                                    button:hover {\n                                        background-color: #218838;\n                                    }\n                                </style>\n                            </head>\n                            <body>\n                                <div class="container">\n                                    <h2>QR Code สำหรับชำระเงิน</h2>\n                                    <div class="price">จำนวนเงิน: '.concat(e,' บาท</div>\n                                    <img src="').concat(r.url,'" alt="QR Code Promptpay">\n                                    <button onclick="confirmPayment()">ยืนยันการชำระเงิน</button>\n                                </div>\n                                <script>\n                                    function confirmPayment() {\n                                        window.opener.confirmQRPayment();\n                                        window.close();\n                                    }\n                                </script>\n                            </body>\n                        </html>\n                    '))}else c().fire("เกิดข้อผิดพลาด",r.RespMessage,"error")}catch(e){console.error("Error generating QR Code:",e),c().fire("เกิดข้อผิดพลาด","ไม่สามารถสร้าง QR Code ได้","error")}};window.confirmQRPayment=async()=>{try{await w(),c().fire("การชำระเงินสำเร็จ!","","success").then(()=>{_.push("/backend/Order/Order")})}catch(e){console.error("Error confirming QR payment:",e)}};let I=async()=>{let e=g.map(e=>({Product_Info:{Product_ID:e.Product_Info.Product_ID,Product_Amount:parseInt(document.getElementById("amount-".concat(e.Product_Info.Product_ID)).value),Product_Price:e.Product_Info.Product_Price},RepairInfo:e.RepairInfo,LicensePlate:e.LicensePlate,licensePlate_ID:e.licensePlate_ID})),n={userId:x.User_ID,userName:x.User_Name,userTel:x.User_Tel,orderNote:x.Order_Note,orderDetails:e};try{let e=await fetch("https://server.jtppmotor.com/api/update_orderRepair/".concat(y),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(e.ok)c().fire("บันทึกจำนวนสินค้าเรียบร้อย!","","success").then(()=>{_.reload()}),b(!1);else{let n=await e.json();c().fire("เกิดข้อผิดพลาดในการบันทึก",n.error,"error")}}catch(e){console.error("Error updating order:",e),c().fire("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลได้","error")}};if(!x)return(0,t.jsx)("div",{children:"Loading..."});let R=x.Repair_Details||[],k=R.reduce((e,n)=>e+parseFloat(n.Product_Info.Product_Price)*parseInt(n.Product_Info.Product_Amount),0),C=async()=>{let e="ซ่อมเสร็จแล้ว"===R[0].RepairInfo.Repair_Status?"กำลังดำเนินการซ่อม":"ซ่อมเสร็จแล้ว",n="ซ่อมเสร็จแล้ว"===R[0].RepairInfo.Repair_Status?"ต้องการยกเลิกสถานะซ่อมเสร็จแล้วหรือไม่?":"ยืนยันการเปลี่ยนสถานะ?";c().fire({title:n,icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก"}).then(async n=>{if(n.isConfirmed)try{(await fetch("https://server.jtppmotor.com/api/update_status/".concat(y),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Repair_Status:e,Order_Status:e})})).ok?c().fire("สำเร็จ","เปลี่ยนสถานะเรียบร้อย","success").then(()=>{N()}):c().fire("ข้อผิดพลาด","ไม่สามารถเปลี่ยนสถานะได้","error")}catch(e){console.error("Error updating order status:",e),c().fire("ข้อผิดพลาด","ไม่สามารถอัปเดตสถานะออเดอร์ได้","error")}})};return(0,t.jsxs)("div",{className:"d-flex",children:[(0,t.jsx)(o.default,{}),(0,t.jsx)("div",{className:"flex-grow-1 bg-light",children:(0,t.jsxs)("div",{className:"container",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom",children:[(0,t.jsxs)("h1",{className:"h2",children:["รายละเอียดการซ่อม #",x.Order_ID]}),(0,t.jsx)("div",{className:"btn-toolbar mb-2 mb-md-0",children:(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{_.push("/backend/Order/Order")},children:"ย้อนกลับ"})})]}),(0,t.jsxs)("div",{className:"card shadow-sm mb-4",children:[(0,t.jsx)("div",{className:"card-header bg-primary text-white",children:(0,t.jsx)("h5",{className:"mb-0",children:"ข้อมูลลูกค้า"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ชื่อ:"})," ",x.User_Name]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"เบอร์โทร:"})," ",x.User_Tel]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"อีเมล:"})," ",x.User_Email||"ไม่พบข้อมูล"]})})]})})]}),(0,t.jsxs)("div",{className:"card shadow-sm mb-4",children:[(0,t.jsx)("div",{className:"card-header bg-success text-white",children:(0,t.jsx)("h5",{className:"mb-0",children:"รายละเอียดการซ่อม"})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ยี่ห้อรถ:"})," ",(null===(n=R[0])||void 0===n?void 0:null===(e=n.LicensePlate)||void 0===e?void 0:e.Brands_name)||"-"]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"รุ่นรถ:"})," ",(null===(a=R[0])||void 0===a?void 0:null===(r=a.LicensePlate)||void 0===r?void 0:r.Models_Name)||"-"]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ทะเบียนรถ:"})," ","".concat((null===(l=R[0])||void 0===l?void 0:null===(d=l.LicensePlate)||void 0===d?void 0:d.Alphabet)||""," ").concat((null===(p=R[0])||void 0===p?void 0:null===(h=p.LicensePlate)||void 0===h?void 0:h.Arabic_Numbers)||""," ").concat((null===(m=R[0])||void 0===m?void 0:null===(u=m.LicensePlate)||void 0===u?void 0:u.Province)||"")]})})]}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"วันที่นำรถเข้ามาที่ร้าน:"})," ",new Date(R[0].RepairInfo.Repair_Date).toLocaleDateString()]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"วันที่คาดว่าจะซ่อมเสร็จ:"})," ",new Date(R[0].RepairInfo.Repair_PickupDate).toLocaleDateString()]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"สถานะการซ่อม:"}),(0,t.jsx)("span",{className:"".concat("กำลังดำเนินการซ่อม"===R[0].RepairInfo.Repair_Status?"bg-warning":"ซ่อมเสร็จแล้ว"===R[0].RepairInfo.Repair_Status?"bg-success text-white":""," rounded-pill px-2"),children:R[0].RepairInfo.Repair_Status})]})}),(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"หมายเหตุ:"})," ",x.Order_Note||"-"]})})]})]})]}),(0,t.jsxs)("div",{className:"card shadow-sm mb-4",children:[(0,t.jsx)("div",{className:"card-header bg-info text-white",children:(0,t.jsx)("h5",{className:"mb-0",children:"รายการอะไหล่และบริการ"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-striped",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"รหัสสินค้า"}),(0,t.jsx)("th",{children:"ยี่ห้อ"}),(0,t.jsx)("th",{children:"รุ่น"}),(0,t.jsx)("th",{children:"ชื่อสินค้า"}),(0,t.jsx)("th",{children:"ราคา"}),(0,t.jsx)("th",{children:"จำนวน"}),(0,t.jsx)("th",{children:"ราคารวม"}),(0,t.jsx)("th",{children:"สถานะ"})]})}),(0,t.jsx)("tbody",{children:R.map((e,n)=>{let r=parseFloat(e.Product_Info.Product_Price)||0,s=parseInt(e.Product_Info.Product_Amount)||0,i=r*s;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.Product_Info.Product_ID||"-"}),(0,t.jsx)("td",{children:e.Product_Info.Product_Brand||"-"}),(0,t.jsx)("td",{children:e.Product_Info.Product_Model||"-"}),(0,t.jsx)("td",{children:e.Product_Info.Product_Name||"ไม่มีสินค้า"}),(0,t.jsx)("td",{children:r.toFixed(2)}),(0,t.jsx)("td",{children:j?(0,t.jsx)("input",{type:"number",id:"amount-".concat(e.Product_Info.Product_ID||n),defaultValue:s,className:"form-control",disabled:!e.Product_Info.Product_ID}):(0,t.jsx)("span",{children:s})}),(0,t.jsx)("td",{children:i.toFixed(2)}),(0,t.jsx)("td",{children:1===parseInt(e.Product_Info.Repair_parts)?(0,t.jsx)("span",{className:"badge bg-info",children:"อะไหล่ซ่อม"}):(0,t.jsx)("span",{className:"badge bg-secondary",children:"สินค้าขายออก"})})]},n)})})]})})})]}),(0,t.jsxs)("div",{className:"card shadow-sm mb-4",children:[(0,t.jsx)("div",{className:"card-header bg-warning text-dark",children:(0,t.jsx)("h5",{className:"mb-0",children:"สรุปค่าใช้จ่าย"})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ราคารวมอะไหล่:"})," ",k.toFixed(2)," บาท"]})}),(0,t.jsx)("div",{className:"col-md-6",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ค่าแรง:"})," ",R[0].RepairInfo.Repair_Costwork," บาท"]})})]}),(0,t.jsx)("div",{className:"row",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("h4",{children:[(0,t.jsx)("strong",{children:"ราคารวมทั้งหมด:"})," ",(k+parseFloat(R[0].RepairInfo.Repair_Costwork)).toFixed(2)," บาท"]})})})]})]}),(0,t.jsxs)("div",{className:"d-flex gap-2 justify-content-end w-98",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-warning",onClick:()=>{b(!j)},children:j?"ยกเลิก":"แก้ไขจำนวนสินค้า"}),j&&(0,t.jsx)("button",{type:"button",className:"btn btn-primary",onClick:I,children:"บันทึกจำนวนสินค้า"}),(0,t.jsx)("button",{type:"button",className:"btn btn-primary",onClick:C,children:"ซ่อมเสร็จแล้ว"===R[0].RepairInfo.Repair_Status?"ยกเลิกสถานะซ่อม":"เปลี่ยนสถานะการซ่อม"}),(0,t.jsx)("button",{type:"button",className:"btn btn-success",onClick:()=>{c().fire({title:"ช่องทางการชำระเงิน?",icon:"question",showCancelButton:!0,confirmButtonText:"ชำระเงินสด",cancelButtonText:"ชำระผ่าน QRcode Promptpay"}).then(e=>{e.isConfirmed?c().fire({title:"กรุณายืนยัน",text:"ยืนยันว่าชำระเงินเสร็จสิ้นแล้วหรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก"}).then(async e=>{e.isConfirmed&&(await w(),c().fire("การชำระเงินสำเร็จ!","","success"),_.push("/backend/Order/Order"))}):e.dismiss===c().DismissReason.cancel&&P(x.Order_TotalPrice)})},children:"ยืนยันการขาย"})]})]})})]})}}},function(e){e.O(0,[2198,2888,9774,179],function(){return e(e.s=8670)}),_N_E=e.O()}]);