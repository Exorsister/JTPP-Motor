"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2198],{2198:function(e,s,a){a.r(s),a.d(s,{default:function(){return x}});var i=a(5893),r=a(7294),t=a(3935),l=a(1163),n=a(4184),c=a.n(n),o=a(6245),d=a(6455),m=a.n(d);function h(e){let{passwordData:s,setPasswordData:a,handlePasswordChange:r,onClose:l}=e;return t.createPortal((0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"modal-backdrop fade show",style:{zIndex:1040}}),(0,i.jsx)("div",{className:"modal fade show",id:"passwordChangeModal",tabIndex:"-1",style:{position:"fixed",top:0,left:0,zIndex:1050,display:"block"},children:(0,i.jsx)("div",{className:"modal-dialog",children:(0,i.jsxs)("div",{className:"modal-content bg-white",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h5",{className:"modal-title text-dark",children:"เปลี่ยนรหัสผ่าน"}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:l})]}),(0,i.jsx)("div",{className:"modal-body",children:(0,i.jsxs)("form",{onSubmit:r,children:[(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label text-dark",children:"รหัสผ่านปัจจุบัน"}),(0,i.jsx)("input",{type:"password",className:"form-control",value:s.currentPassword,onChange:e=>a({...s,currentPassword:e.target.value}),required:!0})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label text-dark",children:"รหัสผ่านใหม่"}),(0,i.jsx)("input",{type:"password",className:"form-control",value:s.newPassword,onChange:e=>a({...s,newPassword:e.target.value}),required:!0})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label text-dark",children:"ยืนยันรหัสผ่านใหม่"}),(0,i.jsx)("input",{type:"password",className:"form-control",value:s.confirmPassword,onChange:e=>a({...s,confirmPassword:e.target.value}),required:!0})]}),(0,i.jsx)("button",{type:"submit",className:"btn btn-warning w-100",children:"เปลี่ยนรหัสผ่าน"})]})})]})})})]}),document.body)}function x(){let e=(0,l.useRouter)(),[s,a]=(0,r.useState)(e.pathname),[t,n]=(0,r.useState)(null),[d,x]=(0,r.useState)(0),[b,u]=(0,r.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[p,f]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>{f(!0)},[]),(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");if(e)try{let s=(0,o.Z)(e),a="User"===s.role?"https://server.jtppmotor.com/api/get_customers/".concat(s.User_ID):"https://server.jtppmotor.com/api/get_admins/".concat(s.User_ID),i=await fetch(a),r=await i.json();n({...s,profile_img:r.profile_img})}catch(e){console.error("Error fetching user info:",e)}})()},[d]);let k=s=>{a(s),e.push(s)},v=async e=>{e.preventDefault();let s=localStorage.getItem("token"),a=(0,o.Z)(s);if(b.newPassword!==b.confirmPassword){m().fire({title:"ข้อผิดพลาด",text:"รหัสผ่านใหม่และยืนยันรหัสผ่านไม่ตรงกัน",icon:"error"});return}try{if(!(await fetch("https://server.jtppmotor.com/api/change_password/".concat(a.User_ID),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({currentPassword:b.currentPassword,newPassword:b.newPassword})})).ok)throw Error("ไม่สามารถเปลี่ยนรหัสผ่านได้");await m().fire({title:"สำเร็จ",text:"เปลี่ยนรหัสผ่านเรียบร้อยแล้ว",icon:"success"}),u({currentPassword:"",newPassword:"",confirmPassword:""}),w(!1)}catch(e){console.error("Error:",e),await m().fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error"})}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"d-flex flex-column flex-shrink-0 p-3 text-white bg-dark sidebar",style:{width:"280px",height:"100vh"},children:[(0,i.jsxs)("div",{className:"dropdown",children:[(0,i.jsxs)("button",{className:"btn dropdown-toggle text-white w-100 d-flex align-items-center",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",children:[(0,i.jsx)("div",{style:{width:"38px",height:"38px",borderRadius:"50%",border:"2px solid #fff",overflow:"hidden",marginRight:"10px"},children:(null==t?void 0:t.profile_img)?(0,i.jsx)("img",{src:"https://server.jtppmotor.com/uploads/".concat(t.profile_img),alt:"Profile",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("i",{className:"bi bi-person-fill",style:{width:"100%",height:"100%",fontSize:"24px",display:"flex",alignItems:"center",justifyContent:"center"}})}),(0,i.jsx)("span",{children:(null==t?void 0:t.firstName)||"Admin"})]}),(0,i.jsxs)("ul",{className:"dropdown-menu dropdown-menu-dark w-100",children:[(0,i.jsx)("li",{children:(0,i.jsxs)("div",{className:"dropdown-item text-white-50",children:[(0,i.jsx)("i",{className:"bi bi-envelope me-2"}),null==t?void 0:t.email]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("button",{className:"dropdown-item text-white",onClick:()=>w(!0),children:[(0,i.jsx)("i",{className:"bi bi-key me-2"}),"เปลี่ยนรหัสผ่าน"]})})]})]}),(0,i.jsx)("hr",{}),(0,i.jsxs)("ul",{className:"nav nav-pills flex-column mb-auto",children:[(0,i.jsx)("li",{className:"nav-item",children:(0,i.jsxs)("a",{href:"/backend/Main",className:c()("nav-link text-white",{active:"/backend/Main"===s}),onClick:()=>k("/backend/Main"),"aria-current":"page",children:[(0,i.jsx)("i",{className:"bi bi-house-door-fill me-2"}),"หน้าหลัก"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"/backend/Product/Product_list",className:c()("nav-link text-white",{active:"/backend/Product/Product_list"===s}),onClick:()=>k("/backend/Product/Product_list"),children:[(0,i.jsx)("i",{className:"bi bi-cart4 me-2"}),"รายการสินค้า"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"/backend/Order/Order",className:c()("nav-link text-white",{active:"/backend/Order/Order"===s}),onClick:()=>k("/backend/Order/Order"),children:[(0,i.jsx)("i",{className:"bi bi-clipboard2-fill me-2"}),"ออเดอร์"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"/backend/Repair/Repair_his",className:c()("nav-link text-white",{active:"/backend/Repair/Repair_his"===s}),onClick:()=>k("/backend/Repair/Repair_his"),children:[(0,i.jsx)("i",{className:"bi bi-tools me-2"}),"ประวัติการซ่อม"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"/backend/Sales/Sales_his",className:c()("nav-link text-white",{active:"/backend/Sales/Sales_his"===s}),onClick:()=>k("/backend/Sales/Sales_his"),children:[(0,i.jsx)("i",{className:"bi bi-cash-coin me-2"}),"ประวัติการขาย"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"/backend/IE/Income_Expenses",className:c()("nav-link text-white",{active:"/backend/IE/Income_Expenses"===s}),onClick:()=>k("/backend/IE/Income_Expenses"),children:[(0,i.jsx)("i",{className:"bi bi-safe-fill me-2"}),"รายรับ-รายจ่าย"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"/backend/Car/Car",className:c()("nav-link text-white",{active:"/backend/Car/Car"===s}),onClick:()=>k("/backend/Car/Car"),children:[(0,i.jsx)("i",{className:"bi bi-scooter me-2"}),"รายชื่อข้อมูลรถ"]})}),(0,i.jsx)("li",{className:"nav-item",children:(0,i.jsxs)("a",{href:"/backend/Admin/Administrator",className:c()("nav-link text-white",{active:"/backend/Admin/Administrator"===s}),onClick:()=>k("/backend/Admin/Administrator"),children:[(0,i.jsx)("i",{className:"bi bi-person-fill-gear me-2"}),"ผู้ดูแลระบบ"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"/backend/Cus/Customer",className:c()("nav-link text-white",{active:"/backend/Cus/Customer"===s}),onClick:()=>k("/backend/Cus/Customer"),children:[(0,i.jsx)("i",{className:"bi bi-people-fill me-2"}),"รายชื่อลูกค้า"]})})]}),(0,i.jsx)("hr",{}),(0,i.jsxs)("a",{href:"/",className:"nav-link text-white",onClick:()=>{localStorage.removeItem("token"),e.push("/")},children:[(0,i.jsx)("i",{className:"bi bi-door-open-fill me-2"}),"ออกจากระบบ"]})]}),p&&j&&(0,i.jsx)(h,{passwordData:b,setPasswordData:u,handlePasswordChange:v,onClose:()=>w(!1)})]})}}}]);